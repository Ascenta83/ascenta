<!doctype html>
<html>
<head>
  <meta charset="utf-8">

  <link rel="preload" href="forced_square.woff2" as="font" type="font/woff2" crossorigin="anonymous"/>
  <link rel="preload" href="images/logo.svg" as="image" type="image/svg+xml"/>
  <link rel="preload" href="images/discord.svg" as="image" type="image/svg+xml"/>

  <link rel="manifest" href="manifest.json"/>

  <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,viewport-fit=cover,user-scalable=no">
</head>

<body style="margin:0;background:black;color:white;font-family:system-ui">

<div id="lock" style="
  position:fixed;inset:0;
  display:flex;align-items:center;justify-content:center;
  background:radial-gradient(circle at top,#111,#000);
  z-index:9999">

  <div style="
    background:#0b0b0b;
    padding:30px 28px;
    border-radius:14px;
    box-shadow:0 0 30px rgba(0,0,0,.8);
    min-width:260px;
    text-align:center">

    <h2 style="margin:0 0 12px;font-weight:600">Access Key</h2>

    <input id="keyInput"
      placeholder="#####"
      maxlength="5"
      style="
        width:100%;
        padding:10px;
        font-size:18px;
        border-radius:8px;
        border:none;
        outline:none;
        text-align:center;
        letter-spacing:3px;
      ">

    <button onclick="checkKey()" style="
      margin-top:12px;
      width:100%;
      padding:10px;
      border:none;
      border-radius:8px;
      background:#1e90ff;
      color:white;
      font-size:15px;
      cursor:pointer">
      Unlock
    </button>

    <div id="msg" style="color:#ff4d4d;margin-top:10px;font-size:14px"></div>

  </div>
</div>

<!-- GAME HUB -->
<canvas id="screen"></canvas>
<div id="ui"></div>
<div id="transition-layer"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* ðŸ”´ YOUR FIREBASE CONFIG */
const firebaseConfig = {
  apiKey: "AIzaSyA-xmCzHc0_sXOxOyAHppw1brgX0CX8dfU",
  authDomain: "hwid-lock.firebaseapp.com",
  projectId: "hwid-lock",
  storageBucket: "hwid-lock.firebasestorage.app",
  messagingSenderId: "151533882029",
  appId: "1:151533882029:web:561773ea8e9108ed99d424"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* HWID (browser fingerprint) */
function getHWID() {
  return btoa(
    navigator.userAgent +
    screen.width +
    screen.height +
    navigator.language +
    Intl.DateTimeFormat().resolvedOptions().timeZone
  );
}

/* LOAD GAME FILES */
function load(s){
  const e=document.createElement("script");
  e.src=s;
  e.defer=true;
  document.head.appendChild(e);
}

function unlock(){
  document.getElementById("lock").style.display = "none";
  load("error_screen.bundle.js");
  load("main.bundle.js");
}

/* KEY CHECK */
window.checkKey = async function () {
  const key = document.getElementById("keyInput").value.trim();
  const msg = document.getElementById("msg");

  if (!key) {
    msg.textContent = "Enter key";
    return;
  }

  const hwid = getHWID();

  try {
    const ref = doc(db, "keys", key);
    const snap = await getDoc(ref);

    if (!snap.exists()) {
      msg.textContent = "Invalid key";
      return;
    }

    const data = snap.data();

    if (!data.used) {
      await updateDoc(ref, { used: true, hwid: hwid });
      unlock();
      return;
    }

    if (data.hwid === hwid) {
      unlock();
    } else {
      msg.textContent = "Key already used on another device";
    }
  } catch (e) {
    msg.textContent = "Connection error";
    console.error(e);
  }
};
</script>

</body>
</html>

