<!doctype html>
<html>
<head>
<meta charset="utf-8">

<link rel="preload" href="forced_square.woff2" as="font" type="font/woff2" crossorigin="anonymous"/>
<link rel="preload" href="images/logo.svg" as="image" type="image/svg+xml"/>
<link rel="preload" href="images/discord.svg" as="image" type="image/svg+xml"/>

<link rel="manifest" href="manifest.json"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">

<title>ASCENT 2</title>

<style>
body{margin:0;background:#050505;color:white;font-family:system-ui}
#lock{
  position:fixed;inset:0;background:#050505;z-index:9999;
  display:flex;align-items:center;justify-content:center;
}
.box{
  width:90%;max-width:360px;background:#0f0f0f;padding:24px;
  border-radius:16px;text-align:center;box-shadow:0 0 40px rgba(0,0,0,.7)
}
h1{margin:0 0 6px;letter-spacing:2px}
input{
  width:100%;padding:14px;border-radius:10px;border:none;
  font-size:16px;margin-top:10px
}
button{
  width:100%;padding:14px;border-radius:10px;border:none;
  background:#4f46e5;color:white;font-size:16px;margin-top:12px
}
#msg{margin-top:10px;min-height:22px}
</style>
</head>

<body>

<!-- LOCK SCREEN -->
<div id="lock">
  <div class="box">
    <h1>ASCENT 2</h1>
    <p style="opacity:.7;font-size:14px">Enter your access key</p>
    <input id="keyInput" placeholder="Access Key">
    <button id="unlockBtn">UNLOCK</button>
    <p id="msg"></p>
  </div>
</div>

<!-- GAME HUB -->
<canvas id="screen"></canvas>
<div id="ui"></div>
<div id="transition-layer"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyA-xmCzHc0_sXOxOyAHppw1brgX0CX8dfU",
  authDomain: "hwid-lock.firebaseapp.com",
  projectId: "hwid-lock",
  storageBucket: "hwid-lock.firebasestorage.app",
  messagingSenderId: "151533882029",
  appId: "1:151533882029:web:561773ea8e9108ed99d424"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const hwid = btoa(
  navigator.userAgent +
  screen.width +
  screen.height +
  navigator.language
);

const msg = document.getElementById("msg");
const input = document.getElementById("keyInput");

document.getElementById("unlockBtn").onclick = tryUnlock;
input.addEventListener("keydown",e=>{if(e.key==="Enter")tryUnlock();});

async function tryUnlock(){
  const key = input.value.trim();
  if(!key) return;

  msg.textContent="Checking...";

  // üëë ADMIN KEY (BYPASS)
  const adminSnap = await getDoc(doc(db,"admin_keys",key));
  if(adminSnap.exists()){
    msg.style.color="#4ade80";
    msg.textContent="WE MAKIN IT OUT FR üî•";
    setTimeout(unlock,600);
    return;
  }

  // üîë UNUSED KEY
  const keyRef = doc(db,"keys",key);
  const keySnap = await getDoc(keyRef);
  if(keySnap.exists()){
    await setDoc(doc(db,"used_keys",key),{hwid,time:Date.now()});
    await deleteDoc(keyRef);
    unlock();
    return;
  }

  // üîí USED KEY
  const usedSnap = await getDoc(doc(db,"used_keys",key));
  if(usedSnap.exists()){
    if(usedSnap.data().hwid===hwid){
      unlock();
    } else {
      msg.style.color="#f87171";
      msg.textContent="üòà Nice try haha, this key is locked to another device.";
    }
    return;
  }

  msg.style.color="#f87171";
  msg.textContent="‚ùå Invalid key.";
}

function unlock(){
  document.getElementById("lock").remove();
  load("error_screen.bundle.js");
  load("main.bundle.js");
}

function load(s){
  const e=document.createElement("script");
  e.src=s;e.defer=true;document.head.appendChild(e);
}
</script>

</body>
</html>
