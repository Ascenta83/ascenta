<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ASCENT 2</title>

<style>
  body { margin:0; background:#050505; color:white; font-family:system-ui; overflow:hidden; }

  .screen {
    position:fixed; inset:0; display:flex; align-items:center; justify-content:center;
    background:#050505; z-index:9999;
  }

  .box {
    width:90%; max-width:380px; background:#0f0f0f; padding:22px;
    border-radius:16px; text-align:center; box-shadow:0 0 40px rgba(0,0,0,.7);
  }

  h1 { margin:0 0 10px; letter-spacing:2px; }

  .red { color:#ff4d4d; }

  button {
    width:100%; padding:14px; border-radius:10px; border:none;
    background:#4f46e5; color:white; font-size:16px; margin-top:12px;
  }

  input {
    width:100%; padding:14px; border-radius:10px; border:none; font-size:16px;
  }

  #msg { margin-top:10px; min-height:22px; }

  /* Car animation */
  .road {
    position:absolute; bottom:20%; width:100%; height:4px; background:#222;
  }
  .car {
    position:absolute; bottom:20%; left:-80px; width:80px; height:40px;
    background:#ff3b3b; border-radius:8px;
    animation: drive 3s linear infinite;
  }
  .car::before,.car::after{
    content:""; position:absolute; bottom:-10px; width:16px; height:16px;
    background:#000; border-radius:50%;
  }
  .car::before{ left:10px;}
  .car::after{ right:10px;}

  @keyframes drive {
    from { left:-100px; }
    to { left:110%; }
  }
</style>
</head>

<body>

<!-- DISCLAIMER SCREEN -->
<div id="disclaimer" class="screen">
  <div class="box">
    <h1>ASCENT 2</h1>

    <div class="road"></div>
    <div class="car"></div>

    <p class="red" style="font-size:14px; line-height:1.4;">
      We (KAS) remain anonymous and retain full ownership and rights to this website and all related systems.
      Any attempt to bypass, tamper, abuse, reverse engineer, or exploit this service will be detected and may
      result in permanent bans or further repercussions.
      <br><br>
      By continuing, you are granted a limited license to access and use this website under our rules and terms.
      Misuse will result in termination of access.
    </p>

    <button id="playBtn" style="background:none;color:#ff4d4d;font-weight:700;">
      â–¶ PLAY NOW
    </button>
  </div>
</div>

<!-- KEY LOCK SCREEN -->
<div id="lockScreen" class="screen" style="display:none;">
  <div class="box">
    <h2>Enter Access Key</h2>
    <input id="keyInput" placeholder="Enter key">
    <button id="unlockBtn">Unlock</button>
    <p id="msg"></p>
  </div>
</div>

<!-- GAME LOAD -->
<canvas id="screen"></canvas>
<div id="ui"></div>
<div id="transition-layer"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyA-xmCzHc0_sXOxOyAHppw1brgX0CX8dfU",
  authDomain: "hwid-lock.firebaseapp.com",
  projectId: "hwid-lock",
  storageBucket: "hwid-lock.firebasestorage.app",
  messagingSenderId: "151533882029",
  appId: "1:151533882029:web:561773ea8e9108ed99d424"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// soft fingerprint (web only, not real hwid)
const hwid = btoa(navigator.userAgent + screen.width + screen.height + navigator.language);

const playBtn = document.getElementById("playBtn");
const lockScreen = document.getElementById("lockScreen");
const disclaimer = document.getElementById("disclaimer");
const msg = document.getElementById("msg");

playBtn.onclick = () => {
  disclaimer.style.display = "none";
  lockScreen.style.display = "flex";
};

document.getElementById("unlockBtn").onclick = async () => {
  const key = document.getElementById("keyInput").value.trim();
  if (!key) return;

  // ADMIN KEY
  const adminRef = doc(db, "admin_keys", key);
  const adminSnap = await getDoc(adminRef);
  if (adminSnap.exists()) {
    msg.style.color = "#4ade80";
    msg.textContent = "WE MAKIN IT OUT FR ðŸ”¥";
    setTimeout(unlock, 700);
    return;
  }

  // UNUSED KEY
  const keyRef = doc(db, "keys", key);
  const keySnap = await getDoc(keyRef);
  if (keySnap.exists()) {
    await setDoc(doc(db, "used_keys", key), { hwid, time: Date.now() });
    await deleteDoc(keyRef);
    unlock();
    return;
  }

  // USED KEY
  const usedRef = doc(db, "used_keys", key);
  const usedSnap = await getDoc(usedRef);
  if (usedSnap.exists()) {
    if (usedSnap.data().hwid === hwid) {
      unlock();
    } else {
      msg.textContent = "ðŸ˜ˆ Nice try haha, this key is locked to another device.";
    }
    return;
  }

  msg.textContent = "âŒ Invalid key.";
};

function unlock() {
  lockScreen.remove();
  loadGame();
}

function loadGame(){
  const load = s => {
    const e = document.createElement("script");
    e.src = s; e.defer = true; document.head.appendChild(e);
  };
  load("error_screen.bundle.js");
  load("main.bundle.js");
}
</script>

</body>
</html>
